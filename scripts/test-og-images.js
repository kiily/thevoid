#!/usr/bin/env node

/**
 * Script to test OG image generation locally
 * Run with: node scripts/test-og-images.js
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Test configurations for different types of content
const testCases = [
    {
        title: 'The Void',
        description: 'A digital garden of thoughts and ideas',
        category: '',
        type: 'default',
        filename: 'og-default.png'
    },
    {
        title: 'Have You Ever Seen a Tree?',
        description: 'Notes on asking the next question',
        category: 'Philosophy',
        type: 'garden',
        filename: 'og-philosophy.png'
    },
    {
        title: 'Constant Meditation',
        description: 'Finding peace in the everyday moments',
        category: 'Meditation',
        type: 'garden',
        filename: 'og-meditation.png'
    },
    {
        title: 'Digital Garden V1',
        description: 'Building a personal knowledge base with modern web technologies',
        category: 'project',
        type: 'project',
        filename: 'og-project.png'
    },
    {
        title: 'A Very Long Title That Goes Beyond Fifty Characters to Test Responsive Font Sizing',
        description: 'This is a test to see how very long descriptions are handled when they exceed the normal length limits and need to be truncated properly.',
        category: 'Philosophy',
        type: 'garden',
        filename: 'og-long-content.png'
    }
];

// Base URL for testing (change to your local dev server)
const baseUrl = 'http://localhost:4321';

function generateTestUrls() {
    console.log('ðŸŽ¨ OG Image Test URLs\n');
    console.log('Copy these URLs into your browser to test the OG image generation:\n');

    testCases.forEach((testCase, index) => {
        const params = new URLSearchParams({
            title: testCase.title,
            description: testCase.description,
            category: testCase.category,
            type: testCase.type
        });

        const url = `${baseUrl}/api/og.png?${params.toString()}`;

        console.log(`${index + 1}. ${testCase.filename}`);
        console.log(`   Title: ${testCase.title}`);
        console.log(`   Category: ${testCase.category || 'None'}`);
        console.log(`   URL: ${url}`);
        console.log('');
    });

    console.log('ðŸ“ Instructions:');
    console.log('1. Start your development server: npm run dev');
    console.log('2. Copy and paste the URLs above into your browser');
    console.log('3. Each URL should display a generated OG image');
    console.log('4. Check that colors, fonts, and layouts look correct');
    console.log('5. Verify that the void.svg logo appears in the top right');
    console.log('');
    console.log('ðŸš€ For production testing, replace the baseUrl with your deployed URL');
}

function generateMarkdownExamples() {
    console.log('\nðŸ“„ Example meta tags for your pages:\n');

    testCases.slice(0, 2).forEach((testCase) => {
        const params = new URLSearchParams({
            title: testCase.title,
            description: testCase.description,
            category: testCase.category,
            type: testCase.type
        });

        const url = `https://thevoid-five.vercel.app/api/og.png?${params.toString()}`;

        console.log(`<!-- ${testCase.title} -->`);
        console.log(`<meta property="og:image" content="${url}" />`);
        console.log(`<meta property="twitter:image" content="${url}" />`);
        console.log('');
    });
}

// Create output directory if it doesn't exist
const outputDir = path.join(__dirname, '..', 'generated-og-images');
if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
}

// Generate README for the output directory
const readmeContent = `# Generated OG Images

This directory contains test OG images generated by the script.

## Test Cases

${testCases.map((testCase, index) => `
### ${index + 1}. ${testCase.filename}
- **Title:** ${testCase.title}
- **Description:** ${testCase.description}
- **Category:** ${testCase.category || 'None'}
- **Type:** ${testCase.type}
`).join('')}

## How to Test

1. Run \`npm run dev\` to start your development server
2. Run \`node scripts/test-og-images.js\` to see test URLs
3. Visit the URLs in your browser to see the generated images
4. Check that void.svg appears correctly in the top right
5. Verify color schemes match the categories
6. Test responsive font sizing with long titles

## Color Schemes

- **Garden/Default:** Purple gradient (#667eea to #764ba2)
- **Project:** Pink gradient (#f093fb to #f5576c)  
- **Philosophy:** Blue gradient (#4facfe to #00f2fe)
- **Meditation:** Green/pink gradient (#a8edea to #fed6e3)

## Features Implemented

âœ… Dynamic color schemes based on category/type
âœ… void.svg logo integration with proper sizing
âœ… Responsive font sizing for long titles
âœ… Text truncation for long descriptions
âœ… Gradient backgrounds with subtle patterns
âœ… Category badges with proper contrast
âœ… Bottom branding
âœ… Fallback error handling
`;

fs.writeFileSync(path.join(outputDir, 'README.md'), readmeContent);

// Main execution
console.log('ðŸŽ¨ OG Image Generation Test Suite');
console.log('==================================\n');

generateTestUrls();
generateMarkdownExamples();

console.log(`âœ… Test information saved to: ${path.join(outputDir, 'README.md')}`);

export { testCases, generateTestUrls, generateMarkdownExamples };
