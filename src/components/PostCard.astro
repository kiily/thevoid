---
import { format } from 'date-fns';
import { Image } from 'astro:assets';

interface Props {
  title: string;
  description: string;
  publishDate: Date;
  updateDate?: Date;
  url: string;
  tags?: string[];
  image?: ImageMetadata;
  variant?: 'list' | 'card';
}

const { title, description, publishDate, updateDate, url, tags, image, variant = 'card' } = Astro.props;

// Truncate description for card view
const truncatedDescription = description.length > 100
  ? description.slice(0, 100) + '...'
  : description;
---

{variant === 'card' ? (
  <article class="group">
    <a href={url} class="block">
      {image ? (
        <div class="aspect-[16/10] mb-4 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
          <Image
            src={image}
            alt={title}
            width={400}
            height={250}
            class="w-full h-full object-cover transform group-hover:scale-[1.02] transition-transform duration-500 ease-out"
          />
        </div>
      ) : (
        <div class="aspect-[16/10] mb-4 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center">
          <span class="text-4xl opacity-30">ðŸŒ±</span>
        </div>
      )}
      <h3 class="text-lg font-semibold text-garden-primary dark:text-garden-dark-primary group-hover:text-garden-accent dark:group-hover:text-garden-dark-accent transition-colors font-ui mb-2">
        {title}
      </h3>
    </a>
    <p class="text-sm text-body mb-3 leading-relaxed line-clamp-2">
      {truncatedDescription}
    </p>
    <time
      datetime={publishDate.toISOString()}
      class="text-xs text-gray-400 dark:text-gray-500 font-ui uppercase tracking-wide"
    >
      {format(publishDate, 'MMM d, yyyy')}
    </time>
  </article>
) : (
  <article class="group py-6 border-b border-gray-200 dark:border-gray-800 last:border-b-0">
    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3">
      <a href={url} class="block">
        <h3 class="text-lg font-semibold text-garden-primary dark:text-garden-dark-primary group-hover:text-garden-accent dark:group-hover:text-garden-dark-accent transition-colors font-ui">
          {title}
        </h3>
      </a>
      <time
        datetime={publishDate.toISOString()}
        class="text-sm text-body font-ui shrink-0"
      >
        {format(publishDate, 'MMM d, yyyy')}
      </time>
    </div>

    <p class="text-body mb-3 leading-relaxed">{description}</p>

    {tags && tags.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {tags.slice(0, 3).map(tag => (
          <a
            href={`/tag/${tag}`}
            class="text-xs font-medium text-body hover:text-garden-accent dark:hover:text-garden-dark-accent transition-colors font-ui"
          >
            #{tag}
          </a>
        ))}
        {tags.length > 3 && (
          <span class="text-xs text-gray-400 dark:text-gray-600 font-ui">
            +{tags.length - 3} more
          </span>
        )}
      </div>
    )}
  </article>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>