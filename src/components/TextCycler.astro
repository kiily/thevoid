---
interface Props {
	texts: string[];
	interval?: number;
	class?: string;
}

const { texts, interval = 3000, class: className = '' } = Astro.props;
---

<span
	class:list={['text-cycler inline-block relative', className]}
	data-texts={JSON.stringify(texts)}
	data-interval={interval}
>
	<span class="text-cycler-current">{texts[0]}</span>
</span>

<style>
	.text-cycler {
		min-width: 1ch;
	}

	.text-cycler-current {
		display: inline-block;
		animation: fadeSlideIn 0.5s ease-out;
	}

	@keyframes fadeSlideIn {
		0% {
			opacity: 0;
			transform: translateY(20px);
		}
		100% {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.text-cycler-current.fade-out {
		animation: fadeSlideOut 0.3s ease-in forwards;
	}

	@keyframes fadeSlideOut {
		0% {
			opacity: 1;
			transform: translateY(0);
		}
		100% {
			opacity: 0;
			transform: translateY(-20px);
		}
	}
</style>

<script>
	function initTextCyclers() {
		const cyclers = document.querySelectorAll('.text-cycler');

		cyclers.forEach((cycler) => {
			const textsAttr = cycler.getAttribute('data-texts');
			const interval = parseInt(cycler.getAttribute('data-interval') || '3000', 10);

			if (!textsAttr) return;

			const texts: string[] = JSON.parse(textsAttr);
			if (texts.length <= 1) return;

			let currentIndex = 0;
			const textElement = cycler.querySelector('.text-cycler-current') as HTMLElement;

			if (!textElement) return;

			setInterval(() => {
				// Start fade out
				textElement.classList.add('fade-out');

				// After fade out, change text and fade in
				setTimeout(() => {
					currentIndex = (currentIndex + 1) % texts.length;
					textElement.textContent = texts[currentIndex];
					textElement.classList.remove('fade-out');
				}, 300);
			}, interval);
		});
	}

	// Initialize on page load
	initTextCyclers();

	// Re-initialize after Astro page transitions
	document.addEventListener('astro:after-swap', initTextCyclers);
</script>
