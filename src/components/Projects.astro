---
import { DataService, type Project } from '../lib/data-service';
import { Image } from 'astro:assets';
import SectionNumber from './SectionNumber.astro';
import SectionTitle from './SectionTitle.astro';

const projects = await DataService.getProjects();
const sortedProjects = projects.sort((a: Project, b: Project) => {
	// Current projects first, then by start date
	if (
		a.data.status === 'Current Project' &&
		b.data.status !== 'Current Project'
	)
		return -1;
	if (
		a.data.status !== 'Current Project' &&
		b.data.status === 'Current Project'
	)
		return 1;
	return b.data.startDate.getTime() - a.data.startDate.getTime();
});
---

<section id="projects" class="py-24 md:py-32">
	<div class="container mx-auto max-w-5xl px-6 md:px-8">
		<SectionNumber number={3} />
		<SectionTitle>Projects</SectionTitle>
		<p class="text-lg text-body font-body max-w-xl mb-12">
			Things I've built and worked on.
		</p>

		<div class="grid grid-cols-1 md:grid-cols-2 gap-10">
			{
				sortedProjects.map((project: Project) => (
					<article class="group">
						<a href={`/projects/${project.slug}`} class="block">
							<div class="relative aspect-[16/10] mb-5 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
								{project.data.image ? (
									<Image
										src={project.data.image}
										alt={project.data.description}
										widths={[400, 600, 800]}
										sizes="(max-width: 768px) 100vw, 50vw"
										class="object-cover w-full h-full transform group-hover:scale-[1.02] transition-transform duration-500 ease-out"
										quality={80}
										format="webp"
									/>
								) : (
									<div class="w-full h-full flex items-center justify-center">
										<span class="text-4xl opacity-30">ğŸš€</span>
									</div>
								)}
								{project.data.status && (
									<div class="absolute top-3 right-3 px-2.5 py-1 bg-garden-primary/90 dark:bg-garden-dark-primary/90 text-white dark:text-garden-dark-background text-xs font-medium rounded-full backdrop-blur-sm">
										{project.data.status}
									</div>
								)}
							</div>
						</a>

						<div>
							<h3 class="text-xl font-semibold text-garden-primary dark:text-garden-dark-primary mb-2 font-ui">
								<a
									href={`/projects/${project.slug}`}
									class="hover:text-garden-accent dark:hover:text-garden-dark-accent transition-colors"
								>
									{project.data.title}
								</a>
							</h3>
							<p class="text-body font-body mb-4 leading-relaxed">
								{project.data.description}
							</p>

							<div class="flex flex-wrap gap-2">
								{project.data.tags.slice(0, 4).map((tag: string) => (
									<span class="text-xs font-medium text-body font-ui">
										#{tag}
									</span>
								))}
								{project.data.tags.length > 4 && (
									<span class="text-xs text-gray-500 dark:text-gray-400 font-ui">
										+{project.data.tags.length - 4}
									</span>
								)}
							</div>
						</div>
					</article>
				))
			}
		</div>
	</div>
</section>
